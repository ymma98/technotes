# 基函数与数值积分


## 基函数


### 基函数求导

假设 reference cell $S_R$ 的坐标是 $\vec{u}=(r,s,t)$, 有映射 $F(\vec{u}): S_R \rightarrow Q$ ,($Q$ 是 real cell)  $Q$ 的坐标是 $F(\vec{u})=\vec{R}=(x,y,z)$, 则有 Jacobian matrix $J=\frac{\partial F}{\partial u}$

所以积分为

$$
\int_{Q} g(\vec{R}) \, dS = \int_{S_R} g(F(\vec{u})) |\det(J)| \, du.
$$

注意，reference cell 上基函数的值与 real cell 上基函数的值相等:

$$
\hat{\phi}(\vec{u}) = \phi(F(\vec{u})) = \phi(\vec{R}) 
$$

Jacobian 除了出现在积分中，也出现在 gradient 中:
$$
\begin{aligned}
\nabla \hat{\phi}(\vec{u}) &= F^\prime(\vec{u}) \nabla\phi(\vec{R}) \\
&= J^T\nabla \phi(\vec{R})
\end{aligned}
$$
因此也有:
$$
\nabla \phi(\vec{R}) = J^{-T} \nabla \hat{\phi}(\vec{u})
$$

展开写的话，就比较好理解为什么有转置了 ($\hat{\nabla} = J^T \nabla$, $\nabla=J^{-T} \hat{nabla}$) ：

$$
\begin{aligned}
& \frac{\partial \phi}{\partial r}=\frac{\partial \phi}{\partial x} \frac{\partial x}{\partial r}+\frac{\partial \phi}{\partial y} \frac{\partial y}{\partial r}+\frac{\partial \phi}{\partial z} \frac{\partial z}{\partial r} \\
& \frac{\partial \phi}{\partial s}=\frac{\partial \phi}{\partial x} \frac{\partial x}{\partial s}+\frac{\partial \phi}{\partial y} \frac{\partial y}{\partial s}+\frac{\partial \phi}{\partial y} \frac{\partial z}{\partial s} \\
& \frac{\partial \phi}{\partial t}=\frac{\partial \phi}{\partial x} \frac{\partial x}{\partial t}+\frac{\partial \phi}{\partial y} \frac{\partial y}{\partial t}+\frac{\partial \phi}{\partial z} \frac{\partial z}{\partial t}
\end{aligned} \Rightarrow\left[\begin{array}{l}
\frac{\partial \phi}{\partial r} \\
\frac{\partial \phi}{\partial s} \\
\frac{\partial \phi}{\partial t}
\end{array}\right]=\left[\begin{array}{lll}
\frac{\partial x}{\partial r} & \frac{\partial y}{\partial r} & \frac{\partial z}{\partial r} \\
\frac{\partial x}{\partial s} & \frac{\partial y}{\partial s} & \frac{\partial z}{\partial s} \\
\frac{\partial x}{\partial t} & \frac{\partial y}{\partial t} & \frac{\partial z}{\partial t}
\end{array}\right]\left[\begin{array}{l}
\frac{\partial \phi}{\partial x} \\
\frac{\partial \phi}{\partial y} \\
\frac{\partial \phi}{\partial z}
\end{array}\right]
$$


<!--stackedit_data:
eyJoaXN0b3J5IjpbNjkyODc0NzUsMjE0Mjc0NzYyMSwtMTg5Nz
g4OTYzMSwtOTE0MTMxMjgzXX0=
-->