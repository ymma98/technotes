# 翻译单元

## 基本概念

-   翻译单元 (translation unit) 是C++中的基本编译单位。它由**单个源文件的内容，加上该源文件直接或间接包含的任何头文件的内容组成**。一个翻译单元可以被编译成对象文件、库文件或可执行程序。

-   Header File（头文件）。头文件允许**定义接口** (interface)，文件扩展名通常为 `.h`、`.hpp` 或 `.hxx`。它们用于声明函数、类以及其他类型的接口，而具体的实现则保留在分离的源文件中。
    
-   Source File（源文件）。源文件包含具体的实现代码，文件扩展名可能为 `.c`、`.cpp` 或 `.cxx`。源文件中包含从头文件中引入的声明的具体实现。

* 一个典型的编译过程:

![输入图片说明](./imgs/2024-07/iUspa7o9cJJXjhej.png)



* Scope（作用域），是指在代码中可以访问变量、函数或对象的区域。


-   Local Scope / Block Scope（局部作用域 / 块作用域），在函数或代码块内声明的实体称为局部变量。它们只在声明它们的函数或代码块内有效，其内存地址在作用域之外无效。


-   Global Scope / File Scope / Namespace Scope（全局作用域 / 文件作用域 / 命名空间作用域）: 在所有函数外部定义的实体。这些实体在程序的整个生命周期内保持单一的内存位置。

```cpp
int var1; // global scope
int f() {
	int var2; // local scope
}
struct A {
	int var3; // depends on where the instance of 'A' is used
};
```


-   Linkage（链接） 。 链接是指符号对链接器的可见性 (visibility)。

-   No Linkage（无链接）：无链接是指局部作用域内的符号，对链接器不可见。

-   Internal Linkage（内部链接）。内部链接是指只在单个翻译单元的作用域内可见的符号。相同的符号名称在不同翻译单元中具有不同的内存地址。

-   External Linkage（外部链接）。外部链接是指存在于单个翻译单元之外的实体。这些实体在整个程序中可访问，并且在所有翻译单元的组合中具有相同的内存地址。

## 存储类别与期限 (storage class and duration)


-   Storage Duration（存储期限）。存储期限（或称持续性类别, duration class）决定了一个变量的生命周期，即变量何时被创建和销毁。


-   Automatic Storage Duration（自动存储期限） 。局部变量临时分配在寄存器或栈上（取决于编译器、架构等）。如果没有明确初始化，它们的值是未定义的。

-   Static Storage Duration（静态存储期限）。当程序开始时分配对象的存储空间，程序结束时释放。如果没有明确初始化，它将进行零初始化。


-   Dynamic Storage Duration（动态存储期限）。对象的分配和释放通过使用动态内存分配函数（如 `new`/`delete`）进行。如果没有明确初始化，其内存内容是未定义的。


-   (C++11) Thread Storage Duration（线程存储期限）。对象在线程开始时分配，在线程结束时释放。每个线程拥有对象的自己的实例。


<!--stackedit_data:
eyJoaXN0b3J5IjpbMTYzODc3NDY3NywxNzUyMjkzNzNdfQ==
-->